function sort(t,e,r=!1){return t.sort(((t,a)=>{const o=Number(`${t[e]}`.match(/\d+/g)),i=Number(`${a[e]}`.match(/\d+/g));return o>i?r?1:-1:i>o?r?-1:1:0}))}function wordCommit(t,e){const r=Math.abs(t)%100,a=Math.abs(t)%10;return r>10&&r<20?e[2]:a>1&&a<5?e[1]:1==a?e[0]:e[2]}function commitsOfSprint(t,e,r){return t.filter((t=>{const{timestamp:a}=t;return e<=a&&a<=r}))}function commitsGroupBySize(t,e){return t.reduce(((t,r)=>{const{summaries:a}=r,o=e.filter((t=>a.includes(t.id))).map((t=>t.added+t.removed)).reduce(((t,e)=>t+e),0);switch(!0){case o>1001:++t["> 1001 —Å—Ç—Ä–æ–∫–∏"];break;case o>500&&o<=1e3:++t["501 ‚Äî 1000 —Å—Ç—Ä–æ–∫"];break;case o>100&&o<=500:++t["101 ‚Äî 500 —Å—Ç—Ä–æ–∫"];break;case o>=0&&o<=100:++t["1 ‚Äî 100 —Å—Ç—Ä–æ–∫"];break;default:console.log(o)}return t}),{"> 1001 —Å—Ç—Ä–æ–∫–∏":0,"501 ‚Äî 1000 —Å—Ç—Ä–æ–∫":0,"101 ‚Äî 500 —Å—Ç—Ä–æ–∫":0,"1 ‚Äî 100 —Å—Ç—Ä–æ–∫":0,countCommits:t.length})}function renderCategory(t,e){const r=e[1][t],a=e[0]?e[0][t]:0;return{title:t,valueText:`${r} ${wordCommit(r,["–∫–æ–º–º–∏—Ç","–∫–æ–º–º–∏—Ç–∞","–∫–æ–º–º–∏—Ç–æ–≤"])}`,differenceText:`${r>a?"+":r<a?"-":""}${Math.abs(r-a)} ${wordCommit(r-a,["–∫–æ–º–º–∏—Ç","–∫–æ–º–º–∏—Ç–∞","–∫–æ–º–º–∏—Ç–æ–≤"])}`}}function prepareData(t,{sprintId:e}){const r=t.find((t=>"Sprint"===t.type&&t.id===e)),{name:a,startAt:o,finishAt:s}=r;let[n,u,m,c,d]=[[],[],[],[],[]];t.forEach((t=>{const{type:e,createdAt:r,author:a,summaries:i}=t;"User"===e&&n.push(t),"Sprint"===e&&u.push(t),"Comment"===e&&o<=r&&r<=s&&(t.author="object"==typeof a?a.id:a,m.push(t)),"Commit"===e&&(t.author="object"==typeof a?a.id:a,t.summaries=i.map((t=>"object"==typeof t?t.id:t)),c.push(t)),"Summary"===e&&d.push(t)}));const l=n.slice();u=sort(u,"id",!0),n=sort(n,"id",!0);const p=m.reduce(((t,e)=>{let{author:r,likes:a}=e;return a&&(t[r]=(t[r]?t[r]:0)+a.length),t}),{}),h={alias:"vote",data:{title:"–°–∞–º—ã–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",subtitle:a,emoji:"üîé",users:sort(n.map((t=>{const{id:e,name:r,avatar:a}=t;return{id:e,name:r,avatar:a,valueText:`${p[e]} ${wordCommit(p[e],["–≥–æ–ª–æ—Å","–≥–æ–ª–æ—Å–∞","–≥–æ–ª–æ—Å–æ–≤"])}`}})),"valueText")}},f=commitsOfSprint(c,o,s),b=f.reduce(((t,e)=>{let{author:r}=e;return t[r]=(t[r]?t[r]:0)+1,t}),{});let v=n.reduce(((t,e)=>{const{id:r,name:a,avatar:o}=e;return b[r]&&(t=[...t,{id:r,name:a,avatar:o,valueText:`${b[r]}`}]),t}),[]);0===Object.keys(b).length&&(v=l.map((t=>({id:t.id,name:t.name,avatar:t.avatar,valueText:"0"}))));const y={alias:"leaders",data:{title:"–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∫–æ–º–º–∏—Ç–æ–≤",subtitle:a,emoji:"üëë",users:sort(v,"valueText")}},C={alias:"chart",data:{title:"–ö–æ–º–º–∏—Ç—ã",subtitle:a,values:u.map((t=>{const{id:r,name:a,startAt:o,finishAt:i}=t,s={title:`${r}`,hint:a,value:commitsOfSprint(c,o,i).length};return r===e&&(s.active=!0),s})),users:sort(v,"valueText")}},g=u.findIndex((t=>t.id===e)),$=[u[g-1],r].reduce(((t,e)=>{if(e){const{startAt:r,finishAt:a}=e;t=[...t,commitsGroupBySize(commitsOfSprint(c,r,a),d)]}else t=[...t,0];return t}),[]),w=$[1].countCommits,x=$[1].countCommits-($[0]?$[0].countCommits:0),S={alias:"diagram",data:{title:"–†–∞–∑–º–µ—Ä –∫–æ–º–º–∏—Ç–æ–≤",subtitle:a,totalText:`${w} ${wordCommit(w,["–∫–æ–º–º–∏—Ç","–∫–æ–º–º–∏—Ç–∞","–∫–æ–º–º–∏—Ç–æ–≤"])}`,differenceText:`${x>0?"+":x<0?"-":""}${Math.abs(x)} —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞`,categories:[renderCategory("> 1001 —Å—Ç—Ä–æ–∫–∏",$),renderCategory("501 ‚Äî 1000 —Å—Ç—Ä–æ–∫",$),renderCategory("101 ‚Äî 500 —Å—Ç—Ä–æ–∫",$),renderCategory("1 ‚Äî 100 —Å—Ç—Ä–æ–∫",$)]}},T={sun:[],mon:[],tue:[],wed:[],thu:[],fri:[],sat:[]};for(key in T)for(i=0;i<24;i++)T[key].push(0);return[h,y,C,S,{alias:"activity",data:{title:"–ö–æ–º–º–∏—Ç—ã",subtitle:a,data:f.reduce(((t,e)=>{const{timestamp:r}=e,a=new Date(r),o=a.toLocaleString("en",{weekday:"short",timeZone:"Europe/Moscow"}).toLowerCase(),i=Number(a.toLocaleString("en",{hour12:!1,hour:"numeric",timeZone:"Europe/Moscow"}));return t[o][i]=t[o][i]?++t[o][i]:1,t}),T)}}]}module.exports={prepareData};